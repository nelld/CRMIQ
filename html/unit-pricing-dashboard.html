<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Pricing Dashboard</title>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Free -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="../css/base.css">
	<link rel="stylesheet" href="../css/styles.css?v=316">
    <link rel="stylesheet" href="../components/components.css?v=9">
</head>

<body>
    <!-- App Header Component -->
    <div id="app-header-container"></div>

    <!-- Page Header Component -->
    <div id="page-header-container"></div>

    <!-- Tabs Component -->
    <div id="tabs-container" style="margin-top: 80px;"></div>

    <!-- Main Content Area -->
    <main class="mx-auto p-6">
        <div id="tab-content">
            <!-- KPI Tiles Grid -->
            <div class="kpi-grid">
                <!-- Total Properties -->
                <div class="kpi-tile-large-value">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Total properties</h3>
                    </div>
                    <div class="kpi-value-large">5</div>
                </div>
                
                <!-- Properties with Incomplete Setup -->
                <div class="kpi-tile-large-value">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Properties with incomplete setup</h3>
                    </div>
                    <div class="kpi-value-large kpi-value-negative">2</div>
                </div>
                
                <!-- Total Unit Types -->
                <div class="kpi-tile-large-value">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Total unit types</h3>
                    </div>
                    <div class="kpi-value-large">102</div>
                </div>
                
                <!-- Unit Types with Incomplete Setup -->
                <div class="kpi-tile-large-value">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Unit types with incomplete setup</h3>
                    </div>
                    <div class="kpi-value-large kpi-value-negative">18</div>
                </div>
            </div>
            
            <!-- Properties Table -->
            <div class="table-component">
                <div class="table-advanced">
                    <div class="table-header">
                        <div class="table-search">
                            <i class="fas fa-search"></i>
                            <input type="text" class="table-search-input" placeholder="Search properties...">
                        </div>
                        <div class="count badge rounded-pill badge-primary">5</div>
                        <div class="count-title">Properties</div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Property Name</th>
                                <th>Unit Types</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Row 1: Oakwood Apartments -->
                            <tr>
                                <td>
                                    <div class="property-name">Oakwood Apartments</div>
                                    <div class="property-status property-status-complete">Setup Complete</div>
                                </td>
                                <td>
                                    <div class="unit-info">
                                        <div class="unit-count">24 Unit Types</div>
                                        <div class="property-status property-status-complete">Setup Complete</div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-light" onclick="openFeesPageslide('Oakwood Apartments')">View Fees</button>
                                </td>
                            </tr>
                            
                            <!-- Row 2: Riverside Commons -->
                            <tr>
                                <td>
                                    <div class="property-name">Riverside Commons</div>
                                    <div class="property-status property-status-complete">Setup Complete</div>
                                </td>
                                <td>
                                    <div class="unit-info">
                                        <div class="unit-count">18 Unit Types</div>
                                        <div class="property-status property-status-incomplete">
                                            <i class="fas fa-exclamation-circle"></i>
                                            2 Incomplete setup
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-light" onclick="openFeesPageslide('Riverside Commons')">View Fees</button>
                                </td>
                            </tr>
                            
                            <!-- Row 3: Downtown Lofts -->
                            <tr>
                                <td>
                                    <div class="property-name">Downtown Lofts</div>
                                    <div class="property-status property-status-complete">Setup Complete</div>
                                </td>
                                <td>
                                    <div class="unit-info">
                                        <div class="unit-count">32 Unit Types</div>
                                        <div class="property-status property-status-complete">Setup Complete</div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-light" onclick="openFeesPageslide('Downtown Lofts')">View Fees</button>
                                </td>
                            </tr>
                            
                            <!-- Row 4: Sunset Heights -->
                            <tr>
                                <td>
                                    <div class="property-name">Sunset Heights</div>
                                    <div class="property-status property-status-incomplete">
                                        <i class="fas fa-exclamation-circle"></i>
                                        Incomplete Setup
                                    </div>
                                </td>
                                <td>
                                    <div class="unit-info">
                                        <div class="unit-count">12 Unit Types</div>
                                        <div class="property-status property-status-incomplete">
                                            <i class="fas fa-exclamation-circle"></i>
                                            12 Incomplete setup
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-light" onclick="openFeesPageslide('Sunset Heights')">View Fees</button>
                                </td>
                            </tr>
                            
                            <!-- Row 5: Maple Grove Residences -->
                            <tr>
                                <td>
                                    <div class="property-name">Maple Grove Residences</div>
                                    <div class="property-status property-status-incomplete">
                                        <i class="fas fa-exclamation-circle"></i>
                                        Incomplete Setup
                                    </div>
                                </td>
                                <td>
                                    <div class="unit-info">
                                        <div class="unit-count">16 Unit Types</div>
                                        <div class="property-status property-status-incomplete">
                                            <i class="fas fa-exclamation-circle"></i>
                                            4 Incomplete setup
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-light" onclick="openFeesPageslide('Maple Grove Residences')">View Fees</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Load Components Script (Standalone Version) -->
    <script src="../components/components-standalone.js?v=3"></script>
    
    <!-- Initialize Components -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize all components
            CRMComponents.initAll({
                appHeader: true,
                pageHeader: {
                    containerId: 'page-header-container',
                    title: 'Units & Pricing Dashboard',
                    actionsHtml: `
                        <button class="btn btn-link flex items-center gap-2">
                            <i class="fas fa-image"></i>
                            <span>View Floor Plans</span>
                        </button>
                        
                        <div class="form-group floating-label mb-0">
                            <label for="property" class="form-label">Property</label>
                            <div class="flex items-center gap-2 bg-white border border-gray-300" style="height: 36px; padding: 0 12px; border-radius: 8px;">
                                <div class="flex items-center gap-2 px-2 py-1 rounded" style="background-color: #e6f3ff;">
                                    <span class="text-sm font-medium">DNC IQ: Loblolly Pine Villas (lq01)</span>
                                    <button style="color: #0072ce;">
                                        <i class="fas fa-times text-xs"></i>
                                    </button>
                                </div>
                                <button class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-ellipsis-v text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `,
                    hasBreadcrumb: false  // No breadcrumb on this page
                },
                tabs: {
                    containerId: 'tabs-container',
                    tabs: [
                        'All Units',
                        'Leasing Specials',
                        'Unit Type Pricing',
                        'Amenity Pricing',
                        'Term-Based Premiums',
                        'Cost Estimator Fees'
                    ],
                    activeIndex: 5,
                    hasBreadcrumb: false,  // No breadcrumb on this page
                    onChange: (index, tabName) => {
                        console.log('Tab changed to:', tabName);
                        // Handle tab content switching here
                        const contentDiv = document.getElementById('tab-content');
                        contentDiv.innerHTML = `<h2 class="text-xl font-semibold mb-4">${tabName}</h2>
                                                <p class="text-gray-600">Content for ${tabName} will go here...</p>`;
                    }
                }
            });
            
            // Table sorting functionality
            initTableSorting();
            
            // Table search functionality
            initTableSearch();

            // Unit Type Fees: show incomplete setups only (column filter)
            initIncompleteSetupsOnlyFilter();
            
            // Initialize pageslide components
            CRMComponents.initPageslide('pageslide-container');
            CRMComponents.initPageslide('pageslide-edit-container');
        });
        
        function initTableSearch() {
            const searchInput = document.querySelector('.table-search-input');
            if (!searchInput) return;
            
            const table = document.querySelector('.data-table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }

        function applyIncompleteSetupsOnlyFilter(checkbox) {
            if (!checkbox) return;

            const scope = checkbox.closest('.accordion-body') || document;
            const table = scope.querySelector('table.fees-table');
            if (!table) return;

            const headerRow = table.tHead?.rows?.[0];
            const body = table.tBodies?.[0];
            if (!headerRow || !body) return;

            const colCount = headerRow.cells.length;
            const visibleCols = new Set([0]); // Always show Fee Name column

            if (checkbox.checked) {
                const dataRows = Array.from(body.rows).filter(r => !r.classList.contains('fees-section-header'));
                for (let col = 1; col < colCount; col++) {
                    const hasIncomplete = dataRows.some(row => {
                        const cell = row.cells[col];
                        if (!cell) return false;
                        return cell.classList.contains('fee-incomplete-cell') || !!cell.querySelector('.fee-incomplete-sub');
                    });
                    if (hasIncomplete) visibleCols.add(col);
                }
            } else {
                for (let col = 0; col < colCount; col++) visibleCols.add(col);
            }

            // Apply to header
            for (let col = 0; col < colCount; col++) {
                const th = headerRow.cells[col];
                if (th) th.style.display = visibleCols.has(col) ? '' : 'none';
            }

            // Apply to body rows
            const visibleCount = visibleCols.size;
            Array.from(body.rows).forEach(row => {
                if (row.classList.contains('fees-section-header')) {
                    const cell = row.cells[0];
                    if (cell) {
                        if (!cell.dataset.originalColspan) {
                            cell.dataset.originalColspan = String(cell.colSpan || colCount);
                        }
                        cell.colSpan = visibleCount;
                    }
                    return;
                }

                for (let col = 0; col < colCount; col++) {
                    const td = row.cells[col];
                    if (td) td.style.display = visibleCols.has(col) ? '' : 'none';
                }
            });
        }

        function initIncompleteSetupsOnlyFilter() {
            // Event delegation (checkbox is injected inside pageslide content)
            document.addEventListener('change', (e) => {
                const target = e.target;
                if (target && target.id === 'show-incomplete-only') {
                    applyIncompleteSetupsOnlyFilter(target);
                }
            });

            // If present at init time, apply once
            const checkbox = document.getElementById('show-incomplete-only');
            if (checkbox) applyIncompleteSetupsOnlyFilter(checkbox);
        }
        
        function initTableSorting() {
            const table = document.querySelector('.data-table');
            if (!table) return;
            
            const headers = table.querySelectorAll('thead th');
            
            headers.forEach((header, index) => {
                // Skip the last column (action column)
                if (index === headers.length - 1) return;
                
                header.addEventListener('click', () => {
                    const tbody = table.querySelector('tbody');
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    
                    // Determine sort direction
                    const isAscending = header.classList.contains('sorted-asc');
                    
                    // Remove all sorted classes
                    headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
                    
                    // Add appropriate class
                    if (isAscending) {
                        header.classList.add('sorted-desc');
                    } else {
                        header.classList.add('sorted-asc');
                    }
                    
                    // Sort rows
                    rows.sort((a, b) => {
                        const aCell = a.cells[index].textContent.trim();
                        const bCell = b.cells[index].textContent.trim();
                        
                        // Try to parse as numbers first
                        const aNum = parseFloat(aCell.replace(/[^0-9.-]/g, ''));
                        const bNum = parseFloat(bCell.replace(/[^0-9.-]/g, ''));
                        
                        if (!isNaN(aNum) && !isNaN(bNum)) {
                            return isAscending ? bNum - aNum : aNum - bNum;
                        }
                        
                        // Date comparison
                        const aDate = new Date(aCell);
                        const bDate = new Date(bCell);
                        if (!isNaN(aDate) && !isNaN(bDate)) {
                            return isAscending ? bDate - aDate : aDate - bDate;
                        }
                        
                        // String comparison
                        return isAscending 
                            ? bCell.localeCompare(aCell)
                            : aCell.localeCompare(bCell);
                    });
                    
                    // Re-append sorted rows
                    rows.forEach(row => tbody.appendChild(row));
                });
            });
        }
    </script>

    <!-- Pageslide Container -->
    <div id="pageslide-container"></div>
    
    <!-- Second Pageslide Container for Edit Forms -->
    <div id="pageslide-edit-container"></div>

    <!-- Additional Styles for Unit Pricing Page -->
    <style>
        /* Property fee amount styling */
        .property-fee-amount {
            cursor: pointer;
            color: #1f2937;
            font-weight: 500;
        }
        
        .property-fee-amount i {
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .property-fee-amount:hover i {
            opacity: 1;
        }
        
        /* Unit type fees table: edit icon should only show on hovered cell */
        .fees-table .fee-cell-edit-icon {
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .fees-table .fee-cell-editable:hover .fee-cell-edit-icon {
            opacity: 1;
        }
        
        /* Compact table styling for property fees */
        .data-table.table-compact thead th {
            padding: 8px 12px 6px 12px;
        }
        
        .data-table.table-compact tbody td {
            padding: 10px 12px;
        }
        
        /* KPI + table styling for Cost Estimator dashboard */
        .kpi-tile-large-value .kpi-value-large.kpi-value-negative {
            color: #d92c20;
        }
        
        .property-status {
            font-size: 14px;
            margin-top: 2px;
        }
        
        .property-status-complete {
            color: #059669;
        }
        
        .property-status-incomplete {
            color: #d92c20;
        }
        
        .unit-info .unit-count {
            font-weight: 500;
        }
        
        .unit-info .property-status-incomplete i {
            margin-right: 4px;
        }
        
        .property-status-incomplete i {
            color: #d92c20;
        }
        
        .fees-table .fee-incomplete {
            color: #b91c1c;
            font-weight: 500;
        }
    </style>

    <script>
        // Simple modal for "Amount Varies" breakdown
        function openAmountVarianceModal(feeName) {
            // Basic example data for Parking Fee as in the image; extend per fee if needed
            const modalHtml = `
                <div class="modal-overlay">
                    <div class="modal-card">
                        <div class="modal-header">
                            <h3 class="modal-title">${feeName} - Amount Variance by Unit Type</h3>
                            <button class="modal-close" onclick="closeAmountVarianceModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <table class="fees-table">
                                <thead>
                                    <tr>
                                        <th style="width: 200px;">Unit Type</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1BR-A</td>
                                        <td>$85</td>
                                    </tr>
                                    <tr>
                                        <td>1BR-B</td>
                                        <td>No Fee</td>
                                    </tr>
                                    <tr>
                                        <td>2BR-A</td>
                                        <td>$85</td>
                                    </tr>
                                    <tr>
                                        <td>2BR-B</td>
                                        <td>No Fee</td>
                                    </tr>
                                    <tr>
                                        <td>3BR-A</td>
                                        <td>$100</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            const container = document.createElement('div');
            container.id = 'amount-variance-modal';
            container.innerHTML = modalHtml;
            document.body.appendChild(container);
        }

        function closeAmountVarianceModal() {
            const existing = document.getElementById('amount-variance-modal');
            if (existing) {
                existing.remove();
            }
        }

        // Modal for "Settings Vary" breakdown (Frequency/Timing by unit type)
        function openSettingsVarianceModal(feeName) {
            const modalHtml = `
                <div class="modal-overlay">
                    <div class="modal-card">
                        <div class="modal-header">
                            <h3 class="modal-title">${feeName} - Settings Variance by Unit Type</h3>
                            <button class="modal-close" onclick="closeSettingsVarianceModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <table class="fees-table">
                                <thead>
                                    <tr>
                                        <th style="width: 200px;">Unit Type</th>
                                        <th>Frequency</th>
                                        <th>Timing</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1BR-A</td>
                                        <td>One-Time</td>
                                        <td>Application</td>
                                    </tr>
                                    <tr>
                                        <td>1BR-B</td>
                                        <td>One-Time</td>
                                        <td>Application</td>
                                    </tr>
                                    <tr>
                                        <td>2BR-A</td>
                                        <td>Recurring</td>
                                        <td>Move-in</td>
                                    </tr>
                                    <tr>
                                        <td>2BR-B</td>
                                        <td>One-Time</td>
                                        <td>Move-in</td>
                                    </tr>
                                    <tr>
                                        <td>3BR-A</td>
                                        <td>One-Time</td>
                                        <td>Move-in</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            const container = document.createElement('div');
            container.id = 'settings-variance-modal';
            container.innerHTML = modalHtml;
            document.body.appendChild(container);
        }

        function closeSettingsVarianceModal() {
            const existing = document.getElementById('settings-variance-modal');
            if (existing) {
                existing.remove();
            }
        }

        // Function to open fees pageslide (must be global for onclick handlers)
        function openFeesPageslide(propertyName) {
            const headerContent = `
                <div class="fees-pageslide-header" style="display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 16px 24px; border-bottom: 1px solid #e5e7eb; position: relative;">
                    <div style="display: flex; align-items: center; gap: 32px;">
                        <div class="form-group floating-label" style="margin-bottom: 0;">
                            <select class="form-select" id="pageslide-property" style="width: 280px; padding-right: 32px;">
                                <option>Oakwood Apartments</option>
                            </select>
                            <label for="pageslide-property" class="form-label">Property</label>
                        </div>
                        <div class="data-group">
                            <div class="data-label">Unit Types</div>
                            <div class="data-value">24</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 32px;">
                        <span class="tooltip-black tooltip-below">
                            <button class="btn btn-primary mr-5" onclick="openLoadTemplatePageslide()">
                                <i class="fas fa-cloud-arrow-up"></i>
                                Sync all to Cafe
                            </button>
                            <span class="tooltip-text">
                                This button will push all fee changes to your rentcafe website, please give this 5 minutes to display
                            </span>
                        </span>
                        <i class="fas fa-times text-muted fa-2x" onclick="closePageslide()" style="cursor: pointer;"></i>
                    </div>
                </div>
            `;

            const bodyContent = `
                <div style="padding: 24px; max-width: 1400px; margin: 0 auto;">
                <!-- Property Card with Accordions -->
                <div class="card card-shadow-static" style="margin-bottom: 24px;">
                    <div class="card-content" style="padding: 16px 20px;">
                        <div class="card-section" style="margin-bottom: 0;">
                            <div class="card-section-header" style="border-bottom: none; padding-bottom: 4px; margin-bottom: 8px;">
                                <h3 class="card-title" style="font-size: 15px; font-weight: 600; margin: 0;">Property</h3>
                            </div>
                            <div class="card-section-content">
                                <div class="accordion" style="margin-bottom: 0;">

                                    <!-- Section 1: Property Control Fees -->
                                    <div class="accordion-item">
                                        <div class="accordion-header expanded" onclick="togglePropertyFeeSection('property-control-fees')">
                                            <i class="fas fa-chevron-right" id="icon-property-control-fees" style="transform: rotate(90deg);"></i>
                                            <span style="font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px;">
                                                <span>
                                                    Property Control Fees
                                                    <span style="font-size: 12px; color: #6b7280; font-weight: 400;">(4)</span>
                                                </span>
                                                <span class="tooltip-wrapper" data-tooltip="These fees pull from your property control settings">
                                                    <i class="fas fa-info-circle" style="font-size: 12px; color: #9ca3af;"></i>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="accordion-body show" id="content-property-control-fees">
                                            <div class="table-container">
                                                <table class="data-table table-compact" style="max-width: 600px;">
                                                    <thead>
                                                        <tr>
                                                            <th>Fee Name</th>
                                                            <th style="text-align: right;">Amount</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>Late Fee</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Late Fee', '30')">
                                                                    $30
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Month to Month</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Month to Month', '175')">
                                                                    $175
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Transfer Fee</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Transfer Fee', '125')">
                                                                    $125
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Lease Renewal Fee</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Lease Renewal Fee', '85')">
                                                                    $85
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 2: Display Only Fees -->
                                    <div class="accordion-item">
                                        <div class="accordion-header expanded" onclick="togglePropertyFeeSection('custom-property-fees')">
                                            <i class="fas fa-chevron-right" id="icon-custom-property-fees" style="transform: rotate(90deg);"></i>
                                            <span style="font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px;">
                                                <span>
                                                    Display Only Fees
                                                    <span style="font-size: 12px; color: #6b7280; font-weight: 400;">(2)</span>
                                                </span>
                                                <span class="tooltip-wrapper" data-tooltip="These are custom fees that are not setup to bill in the system by default">
                                                    <i class="fas fa-info-circle" style="font-size: 12px; color: #9ca3af;"></i>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="accordion-body show" id="content-custom-property-fees">
                                            <div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
                                                <button class="btn btn-primary" onclick="openAddPropertyDisplayOnlyFeePageslide()">
                                                    <i class="fas fa-circle-plus"></i>
                                                    Add Fee
                                                </button>
                                            </div>
                                            <div class="table-container">
                                                <table class="data-table table-compact" style="max-width: 600px;">
                                                    <thead>
                                                        <tr>
                                                            <th>Fee Name</th>
                                                            <th style="text-align: right;">Amount</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>Utility billing setup fee</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Utility billing setup fee', '15')">
                                                                    $15
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Club house rental fee</td>
                                                            <td style="text-align: right;">
                                                                <span class="property-fee-amount" onclick="openEditPropertyFee('Club house rental fee', '50')">
                                                                    $50
                                                                    <i class="fas fa-pen" style="font-size: 14px; margin-left: 8px;"></i>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unit Type Card with Accordions -->
                <div class="card card-shadow-static">
                    <div class="card-content" style="padding: 16px 20px;">
                        <div class="card-section" style="margin-bottom: 0;">
                            <div class="card-section-header" style="border-bottom: none; padding-bottom: 4px; margin-bottom: 8px;">
                                <h3 class="card-title" style="font-size: 15px; font-weight: 600; margin: 0;">Unit Type</h3>
                            </div>
                            <div class="card-section-content">
                                <div class="accordion" style="margin-bottom: 0;">

                                    <!-- Accordion 1: Unit Type Fees -->
                                    <div class="accordion-item">
                                        <div class="accordion-header expanded" onclick="togglePropertyFeeSection('unit-type-fees')">
                                            <i class="fas fa-chevron-right" id="icon-unit-type-fees" style="transform: rotate(90deg);"></i>
                                            <span style="font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px;">
                                                <span>
                                                    Unit Type Fees
                                                    <span style="font-size: 12px; color: #6b7280; font-weight: 400;">(5)</span>
                                                </span>
                                                <span class="tooltip-wrapper" data-tooltip="These fees pull from unit type setup screen">
                                                    <i class="fas fa-info-circle" style="font-size: 12px; color: #9ca3af;"></i>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="accordion-body show" id="content-unit-type-fees">

                                            <!-- Fees Section -->
                                            <div class="table-advanced" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                                <div class="table-header" style="display: flex; align-items: center;">
                                                    <div class="table-search mr-4">
                                                        <i class="fas fa-search"></i>
                                                        <input type="text" class="table-search-input" placeholder="Search fees..." style="width: 250px;">
                                                    </div>
                                                    <div class="count badge rounded-pill badge-primary ml-0">18</div>
                                                    <div class="count-title">Fees</div>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 16px;">
                                                    <div style="display: flex; align-items: center; gap: 6px; font-size: 13px;">
                                                        <input type="checkbox" id="show-incomplete-only" style="width: auto; height: auto; margin: 0;">
                                                        <label for="show-incomplete-only" class="text-sm text-muted" style="margin: 0; cursor: pointer;">Show incomplete setups only</label>
                                                    </div>
                                                    <button class="btn btn-primary" onclick="openAddFeePageslide()">
                                                        <i class="fas fa-circle-plus"></i>
                                                        Add Fee
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Fees Table -->
                                            <div class="fees-table-container">
                                                <table class="fees-table">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 300px;">Fee Name</th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">1BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(16 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">1BR-B</div>
                                                                    <div class="unit-type-info text-sm text-muted">(12 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">2BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(24 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">2BR-B</div>
                                                                    <div class="unit-type-info text-sm text-muted">(18 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">3BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(8 units)</div>
                                                                </div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- APPLICATION CHARGES -->
                                                        <tr class="fees-section-header">
                                                            <td colspan="6">APPLICATION CHARGES</td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <span style="font-weight: 500;">Application Fee</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-consistent">Settings Consistent</div>
                                                                        <div class="fee-meta text-sm text-consistent">Amount Consistent</div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Application Fee')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Application Fee', '1BR-A', '75')">
                                                                <span class="fee-cell-value">$75</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Application Fee', '1BR-B', '75')">
                                                                <span class="fee-cell-value">$75</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Application Fee', '2BR-A', '75')">
                                                                <span class="fee-cell-value">$75</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Application Fee', '2BR-B', '75')">
                                                                <span class="fee-cell-value">$75</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Application Fee', '3BR-A', '75')">
                                                                <span class="fee-cell-value">$75</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>

                                                        <!-- MOVE-IN CHARGES -->
                                                        <tr class="fees-section-header">
                                                            <td colspan="6">MOVE-IN CHARGES</td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <span style="font-weight: 500;">Security Deposit</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openSettingsVarianceModal('Security Deposit')">Settings Vary</button>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openAmountVarianceModal('Security Deposit')">Amount Varies</button>
                                                                        </div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Security Deposit')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Security Deposit', '1BR-A', '500')">
                                                                <span class="fee-cell-value">$500</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Security Deposit', '1BR-B', '500')">
                                                                <span class="fee-cell-value">$500</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Security Deposit', '2BR-A', '750')">
                                                                <span class="fee-cell-value">$750</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Security Deposit', '2BR-B', '750')">
                                                                <span class="fee-cell-value">$750</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Security Deposit', '3BR-A', '1000')">
                                                                <span class="fee-cell-value">$1000</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <span style="font-weight: 500;">Administrative Fee</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-consistent">Settings Consistent</div>
                                                                        <div class="fee-meta text-sm text-consistent">Amount Consistent</div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Administrative Fee')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Administrative Fee', '1BR-A', '150')">
                                                                <span class="fee-cell-value">$150</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Administrative Fee', '1BR-B', '150')">
                                                                <span class="fee-cell-value">$150</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Administrative Fee', '2BR-A', '150')">
                                                                <span class="fee-cell-value">$150</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Administrative Fee', '2BR-B', '150')">
                                                                <span class="fee-cell-value">$150</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Administrative Fee', '3BR-A', '150')">
                                                                <span class="fee-cell-value">$150</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <span style="font-weight: 500;">Parking Fee</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-consistent">Settings Consistent</div>
                                                                        <div class="fee-meta text-sm text-consistent">Amount Consistent</div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Parking Fee')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Parking Fee', '1BR-A', '85')">
                                                                <span class="fee-cell-value">$85</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Parking Fee', '1BR-B', '0')">
                                                                <span class="fee-cell-value">No Fee</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Parking Fee', '2BR-A', '85')">
                                                                <span class="fee-cell-value">$85</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Parking Fee', '2BR-B', '0')">
                                                                <span class="fee-cell-value">No Fee</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Parking Fee', '3BR-A', '100')">
                                                                <span class="fee-cell-value">$100</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>

                                                        <!-- MOVE-OUT CHARGES -->
                                                        <tr class="fees-section-header">
                                                            <td colspan="6">MOVE-OUT CHARGES</td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <span style="font-weight: 500;">Cleaning Fee</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openSettingsVarianceModal('Cleaning Fee')">Settings Vary</button>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openAmountVarianceModal('Cleaning Fee')">Amount Varies</button>
                                                                        </div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Cleaning Fee')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Cleaning Fee', '1BR-A', '200')">
                                                                <span class="fee-cell-value">$200</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Cleaning Fee', '1BR-B', '200')">
                                                                <span class="fee-cell-value">$200</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Cleaning Fee', '2BR-A', '250')">
                                                                <span class="fee-cell-value">$250</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Cleaning Fee', '2BR-B', '250')">
                                                                <span class="fee-cell-value">$250</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable fee-incomplete-cell" onclick="openEditFeeForUnitTypePageslide('Cleaning Fee', '3BR-A', '300')">
                                                                <div class="fee-incomplete-main">$300</div>
                                                                <div class="fee-incomplete-sub">Incomplete setup</div>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                    </div>

                                    <!-- Accordion 2: Display Only Fees (Unit Type) -->
                                    <div class="accordion-item">
                                        <div class="accordion-header" onclick="togglePropertyFeeSection('unit-type-display-fees')">
                                            <i class="fas fa-chevron-right" id="icon-unit-type-display-fees"></i>
                                            <span style="font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px;">
                                                <span>
                                                    Display Only Fees
                                                    <span style="font-size: 12px; color: #6b7280; font-weight: 400;">(1)</span>
                                                </span>
                                                <span class="tooltip-wrapper" data-tooltip="These are custom fees not setup to bill in the system by default">
                                                    <i class="fas fa-info-circle" style="font-size: 12px; color: #9ca3af;"></i>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="accordion-body" id="content-unit-type-display-fees">

                                            <!-- Display Only Fees Toolbar -->
                                            <div class="table-advanced" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                                <div class="table-header" style="display: flex; align-items: center;">
                                                    <div class="table-search mr-4">
                                                        <i class="fas fa-search"></i>
                                                        <input type="text" class="table-search-input" placeholder="Search fees..." style="width: 220px;">
                                                    </div>
                                                    <div class="count badge rounded-pill badge-primary ml-0">1</div>
                                                    <div class="count-title">Fees</div>
                                                </div>
                                                <button class="btn btn-primary" onclick="openAddFeePageslide()">
                                                    <i class="fas fa-circle-plus"></i>
                                                    Add Fee
                                                </button>
                                            </div>

                                            <!-- Display Only Fees Table -->
                                            <div class="fees-table-container">
                                                <table class="fees-table">
                                                    <thead>
                                                        <tr>
                                                            <th style="width: 300px;">Fee Name</th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">1BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(16 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">1BR-B</div>
                                                                    <div class="unit-type-info text-sm text-muted">(12 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">2BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(24 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">2BR-B</div>
                                                                    <div class="unit-type-info text-sm text-muted">(18 units)</div>
                                                                </div>
                                                            </th>
                                                            <th>
                                                                <div class="unit-type-header">
                                                                    <div class="unit-type-name">3BR-A</div>
                                                                    <div class="unit-type-info text-sm text-muted">(8 units)</div>
                                                                </div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                <div class="fee-name-wrapper">
                                                                    <div class="fee-name-content">
                                                                        <div class="fee-name">
                                                                            <i class="fas fa-circle" style="color: #10b981; font-size: 8px;"></i>
                                                                            <span style="font-weight: 500;">Pet Rent</span>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openSettingsVarianceModal('Pet Rent')">Settings Vary</button>
                                                                        </div>
                                                                        <div class="fee-meta text-sm text-danger">
                                                                            <button type="button" class="link-button" onclick="openAmountVarianceModal('Pet Rent')">Amount Varies</button>
                                                                        </div>
                                                                    </div>
                                                                    <i class="fas fa-pen fee-edit-icon" onclick="openEditFeePageslide('Pet Rent')" style="cursor: pointer;"></i>
                                                                </div>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Pet Rent', '1BR-A', '25')">
                                                                <span class="fee-cell-value">$25</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Pet Rent', '1BR-B', '25')">
                                                                <span class="fee-cell-value">$25</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Pet Rent', '2BR-A', '30')">
                                                                <span class="fee-cell-value">$30</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Pet Rent', '2BR-B', '30')">
                                                                <span class="fee-cell-value">$30</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                            <td class="fee-amount fee-cell-editable" onclick="openEditFeeForUnitTypePageslide('Pet Rent', '3BR-A', '35')">
                                                                <span class="fee-cell-value">$35</span>
                                                                <i class="fas fa-pen fee-cell-edit-icon"></i>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            `;

            // Open pageslide
            openPageslide({
                title: '', // Custom header will be set below
                size: 'full',
                content: bodyContent,
                footer: '' // No footer needed
            });

            // Replace default header with custom header
            setTimeout(() => {
                const pageslideHeader = document.querySelector('.pageslide-header');
                const pageslideFooter = document.querySelector('.pageslide-footer');
                
                if (pageslideHeader) {
                    pageslideHeader.innerHTML = headerContent;
                    pageslideHeader.style.padding = '0';
                    pageslideHeader.style.borderBottom = 'none';
                }
                if (pageslideFooter) {
                    pageslideFooter.style.display = 'none';
                }

                const checkbox = document.getElementById('show-incomplete-only');
                if (checkbox) {
                    applyIncompleteSetupsOnlyFilter(checkbox);
                }
            }, 50);
        }

        // Function to close edit pageslide
        function closeEditPageslide() {
            const overlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const pageslide = document.querySelector('#pageslide-edit-container .pageslide');
            
            if (!overlay || !pageslide) return;
            
            pageslide.classList.remove('active');
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 300);
        }

        // Function to open Edit Fee pageslide (applies to selected unit types)
        function openEditFeePageslide(feeName) {
            // Defaults (UI-only demo values)
            const defaultsByFee = {
                'Application Fee': {
                    chargeCode: 'APP_FEE',
                    amountType: 'Fixed',
                    amount: '75.00',
                    required: true,
                    refundable: false,
                    taxable: false,
                    hideFromCostEstimate: false,
                    descriptionPlaceholder: 'Describe the fee for applicants',
                    monthsToStart: '0',
                    duration: '0',
                    limit: '0',
                    chargeClass: 'Admin',
                    category: 'Required',
                    timing: 'Application',
                    frequency: 'One-Time',
                    method: 'Per Unit',
                    paymentTo: 'Property',
                    leaseDocSetting: 'None',
                }
            };

            const defaults = defaultsByFee[feeName] || defaultsByFee['Application Fee'];

            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0;">Edit Fee</h2>
                    <i class="fas fa-times" onclick="closeEditPageslide()" style="cursor: pointer;"></i>
                </div>
            `;

            const formContent = `
                <div style="">
                    <!-- Fee Name and Charge Code -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="fee-name" class="form-label">Fee Name</label>
                            <input type="text" id="fee-name" class="form-input" value="${feeName}">
                        </div>
                        <div class="form-group">
                            <label for="charge-code" class="form-label">Charge Code</label>
                            <input type="text" id="charge-code" class="form-input" value="${defaults.chargeCode}">
                        </div>
                    </div>

                    <!-- Amount Type and Amount -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
                        <div class="form-group">
                            <label for="amount-type" class="form-label">Amount Type</label>
                            <select id="amount-type" class="form-select">
                                <option ${defaults.amountType === 'Fixed' ? 'selected' : ''}>Fixed</option>
                                <option ${defaults.amountType === 'Percentage' ? 'selected' : ''}>Percentage</option>
                                <option ${defaults.amountType === 'Range' ? 'selected' : ''}>Range</option>
                                <option ${defaults.amountType === 'Text' ? 'selected' : ''}>Text</option>
                                <option ${defaults.amountType === 'Average' ? 'selected' : ''}>Average</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount" class="form-label">Amount</label>
                            <input type="text" id="amount" class="form-input" value="${defaults.amount}">
                        </div>
                    </div>

                    <!-- Required/Refundable/Taxable/Hide from Cost Estimate -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; margin-bottom: 24px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="required" ${defaults.required ? 'checked' : ''} style="width: auto; height: auto;">
                                <label for="required" style="margin: 0; font-weight: 400; font-size: 14px !important;">Required</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="refundable" ${defaults.refundable ? 'checked' : ''} style="width: auto; height: auto;">
                                <label for="refundable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Refundable</label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="taxable" ${defaults.taxable ? 'checked' : ''} style="width: auto; height: auto;">
                                <label for="taxable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Taxable</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hide-cost" ${defaults.hideFromCostEstimate ? 'checked' : ''} style="width: auto; height: auto;">
                                <label for="hide-cost" style="margin: 0; font-weight: 400; font-size: 14px !important;">Hide from Cost Estimate</label>
                            </div>
                        </div>
                    </div>

                    <!-- Fee Description -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="fee-description" class="form-label">Fee Description</label>
                        <textarea id="fee-description" class="form-input" rows="3" style="resize: vertical;" placeholder="${defaults.descriptionPlaceholder}"></textarea>
                    </div>

                    <!-- Months to Start / Duration / Limit -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="months-to-start" class="form-label">Months to Start</label>
                            <input type="text" id="months-to-start" class="form-input" value="${defaults.monthsToStart}">
                        </div>
                        <div class="form-group">
                            <label for="duration" class="form-label">Duration</label>
                            <input type="text" id="duration" class="form-input" value="${defaults.duration}">
                        </div>
                        <div class="form-group">
                            <label for="limit" class="form-label">Limit</label>
                            <input type="text" id="limit" class="form-input" value="${defaults.limit}">
                        </div>
                    </div>

                    <!-- Charge Class / Category -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="charge-class" class="form-label">Charge Class</label>
                            <select id="charge-class" class="form-select">
                                <option ${defaults.chargeClass === 'Admin' ? 'selected' : ''}>Admin</option>
                                <option ${defaults.chargeClass === 'Accounting' ? 'selected' : ''}>Accounting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category" class="form-label">Category</label>
                            <select id="category" class="form-select">
                                <option ${defaults.category === 'Required' ? 'selected' : ''}>Required</option>
                                <option ${defaults.category === 'Add-on' ? 'selected' : ''}>Add-on</option>
                                <option ${defaults.category === 'Situational' ? 'selected' : ''}>Situational</option>
                            </select>
                        </div>
                    </div>

                    <!-- Timing / Frequency -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="timing" class="form-label">Timing</label>
                            <select id="timing" class="form-select">
                                <option ${defaults.timing === 'Application' ? 'selected' : ''}>Application</option>
                                <option ${defaults.timing === 'Move-in' ? 'selected' : ''}>Move-in</option>
                                <option ${defaults.timing === 'Move-out' ? 'selected' : ''}>Move-out</option>
                                <option ${defaults.timing === 'Monthly' ? 'selected' : ''}>Monthly</option>
                                <option ${defaults.timing === 'Move-in and Monthly' ? 'selected' : ''}>Move-in and Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="frequency" class="form-label">Frequency</label>
                            <select id="frequency" class="form-select">
                                <option ${defaults.frequency === 'One-Time' ? 'selected' : ''}>One-Time</option>
                                <option ${defaults.frequency === 'Recurring' ? 'selected' : ''}>Recurring</option>
                            </select>
                        </div>
                    </div>

                    <!-- Method / Payment To -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="method" class="form-label">Method</label>
                            <select id="method" class="form-select">
                                <option ${defaults.method === 'Per Unit' ? 'selected' : ''}>Per Unit</option>
                                <option ${defaults.method === 'Per Pet' ? 'selected' : ''}>Per Pet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="payment-to" class="form-label">Payment To</label>
                            <select id="payment-to" class="form-select">
                                <option ${defaults.paymentTo === 'Property' ? 'selected' : ''}>Property</option>
                                <option ${defaults.paymentTo === 'Third Party' ? 'selected' : ''}>Third Party</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lease Doc Setting -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="lease-doc-setting" class="form-label">Lease Doc Setting</label>
                        <select id="lease-doc-setting" class="form-select">
                            <option ${defaults.leaseDocSetting === 'None' ? 'selected' : ''}>None</option>
                            <option ${defaults.leaseDocSetting === 'Both' ? 'selected' : ''}>Both</option>
                            <option ${defaults.leaseDocSetting === 'Lease' ? 'selected' : ''}>Lease</option>
                            <option ${defaults.leaseDocSetting === 'Renewal' ? 'selected' : ''}>Renewal</option>
                        </select>
                    </div>

                    <!-- Apply to Unit Types -->
                    <div style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <label class="form-label" style="margin: 0;">Apply to Unit Types</label>
                            <div style="display: flex; gap: 16px;">
                                <a href="javascript:void(0)" onclick="selectAllUnitTypes()" style="font-size: 14px;">Select All</a>
                                <span style="color: #d1d5db;">|</span>
                                <a href="javascript:void(0)" onclick="deselectAllUnitTypes()" style="font-size: 14px;">Deselect All</a>
                            </div>
                        </div>
                        <div style="max-height: 220px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: white;">
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-1br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-1br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">1BR-A</label>
                                    <span class="text-sm text-muted">16 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-1br-b" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-1br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">1BR-B</label>
                                    <span class="text-sm text-muted">12 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-2br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-2br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">2BR-A</label>
                                    <span class="text-sm text-muted">24 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-2br-b" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-2br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">2BR-B</label>
                                    <span class="text-sm text-muted">18 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-3br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-3br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">3BR-A</label>
                                    <span class="text-sm text-muted">8 units</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span class="text-sm text-muted" id="unit-types-count" data-prefix="Applying to">Applying to 5 unit types</span>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                        <button class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editTitle = document.querySelector('#pageslide-edit-container .pageslide-title');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');
            
            if (editOverlay && editPageslide) {
                // Set content
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;
                
                // Set size
                editPageslide.setAttribute('data-pageslide-size', 'md');
                
                // Show pageslide
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                // Replace default header with custom header
                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }

                    // Checkbox count wiring (reuses helper functions)
                    updateUnitTypesCount();
                    document.querySelectorAll('.unit-type-checkbox').forEach(checkbox => {
                        checkbox.addEventListener('change', updateUnitTypesCount);
                    });
                }, 50);
            }
        }

        // Function to open Edit Fee for specific Unit Type pageslide
        function openEditFeeForUnitTypePageslide(feeName, unitType, amount) {
            // Set default values based on fee type
            let chargeCode = '';
            let description = '';
            // Category options in this form: Required, Add-on, Situational
            let category = 'Required';
            // Timing options: Application, Move-in, Move-out, Monthly, Move-in and Monthly
            let timing = 'Move-in';
            // Frequency options: One-Time, Recurring
            let frequency = 'One-Time';
            // Charge class options: Admin, Accounting
            let chargeClass = 'Admin';
            // Method options: Per Unit, Per Pet
            let method = 'Per Unit';
            // Payment To options: Property, Third Party
            let paymentTo = 'Property';
            // Lease Doc Setting options: None, Both, Lease, Renewal
            let leaseDocSetting = 'None';
            // Start/duration/limit
            let monthsToStart = 0;
            let duration = 0;
            let limit = 0;
            // Checkbox defaults
            let requiredChecked = 'checked';
            let taxableChecked = '';
            let refundableChecked = '';
            
            let templateName = 'Standard Move-In';
            
            if (feeName === 'Security Deposit') {
                chargeCode = 'SEC_DEP';
                description = 'Refundable security deposit';
                category = 'Required';
                timing = 'Move-in';
                frequency = 'One-Time';
                chargeClass = 'Admin';
                refundableChecked = 'checked';
                templateName = 'Standard Move-In';
            } else if (feeName === 'Parking Fee') {
                chargeCode = 'PARKING';
                description = 'Monthly parking fee';
                category = 'Add-on';
                timing = 'Move-in';
                frequency = 'Recurring';
                chargeClass = 'Admin';
                taxableChecked = 'checked';
                method = 'Per Unit';
                templateName = unitType === '3BR-A' ? 'Luxury Units' : 'Standard Move-In';
            } else if (feeName === 'Application Fee') {
                chargeCode = 'APP_FEE';
                description = 'Non-refundable application fee';
                category = 'Required';
                timing = 'Application';
                frequency = 'One-Time';
                chargeClass = 'Admin';
                taxableChecked = 'checked';
                templateName = 'Standard Move-In';
            } else if (feeName === 'Administrative Fee') {
                chargeCode = 'ADMIN_FEE';
                description = 'Non-refundable administrative fee';
                category = 'Required';
                timing = 'Move-in';
                frequency = 'One-Time';
                chargeClass = 'Admin';
                taxableChecked = 'checked';
                templateName = 'Standard Move-In';
            } else if (feeName === 'Cleaning Fee') {
                chargeCode = 'CLEAN_FEE';
                description = 'Move-out cleaning fee';
                category = 'Situational';
                timing = 'Move-out';
                frequency = 'One-Time';
                chargeClass = 'Admin';
                refundableChecked = '';
                templateName = 'Standard Move-In';
            } else if (feeName === 'Pet Rent') {
                chargeCode = 'PET_RENT';
                description = 'Monthly pet rent';
                category = 'Add-on';
                timing = 'Monthly';
                frequency = 'Recurring';
                chargeClass = 'Admin';
                taxableChecked = 'checked';
                method = 'Per Pet';
                templateName = 'Pet-Friendly Units';
            }
            
            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0 0 6px 0;">Edit ${feeName} - ${unitType}</h2>
                    <p class="text-sm text-muted" style="margin: 0;">Changes apply to this unit type only</p>
                    <i class="fas fa-times" onclick="closeEditPageslide()"></i>
                </div>
            `;

            const formContent = `
                <div>
                    <div class="warning-banner" id="warningBanner" style="display: none;">
                        <div class="warning-banner-icon"></div>
                        <div class="warning-banner-text">This function will create a unit type charge as well as the fee structure. These charges will be charged to the tenant at the time selected in the "Charge At" option.</div>
                    </div>
                    <div class="info-banner" id="infoBanner" style="display: none;">
                        <div class="info-banner-icon">i</div>
                        <div class="info-banner-text" id="infoBannerText">The grayed out settings pull directly from Property Control Settings and cannot be modified here.</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fee Name</label>
                            <input type="text" class="form-input" id="feeNameInput" value="${feeName}" placeholder="Enter fee name" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Charge Code</label>
                            <input type="text" class="form-input" id="chargeCodeInput" value="${chargeCode}" placeholder="Enter charge code" disabled>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Amount Type</label>
                            <select class="form-select" id="amountTypeSelect" disabled>
                                <option ${'Fixed' === 'Fixed' ? 'selected' : ''}>Fixed</option>
                                <option>Variable</option>
                                <option>Percentage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <input type="text" class="form-input" id="amountInput" value="${amount}" placeholder="0.00" disabled>
                        </div>
                    </div>

                    <div class="form-row" id="chargeAtRow" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Charge At</label>
                            <select class="form-select" id="chargeAtSelect">
                                <option value="">Select...</option>
                                <option ${timing === 'Application' ? 'selected' : ''}>Application</option>
                                <option ${timing === 'Move-in' ? 'selected' : ''}>Move In</option>
                                <option ${timing === 'Move-out' ? 'selected' : ''}>Move Out</option>
                            </select>
                        </div>
                        <div class="form-group"></div>
                    </div>

                    <!-- Fee flags (match Edit Fee checkbox layout) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; margin-bottom: 24px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="required" ${requiredChecked} disabled style="width: auto; height: auto;">
                                <label for="required" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Required</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="refundable" ${refundableChecked} disabled style="width: auto; height: auto;">
                                <label for="refundable" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Refundable</label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="taxable" ${taxableChecked} disabled style="width: auto; height: auto;">
                                <label for="taxable" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Taxable</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hideEstimate" style="width: auto; height: auto;">
                                <label for="hideEstimate" style="margin: 0; font-weight: 400; font-size: 14px !important;">Hide from Cost Estimate</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Fee Description</label>
                        <textarea class="form-textarea" id="feeDescription" placeholder="Describe the fee for applicants">${description}</textarea>
                    </div>

                    <div class="form-row-three">
                        <div class="form-group">
                            <label class="form-label">Months to Start</label>
                            <input type="number" class="form-input" id="monthsToStart" value="${monthsToStart}" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration</label>
                            <input type="number" class="form-input" id="duration" value="${duration}" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Limit</label>
                            <input type="number" class="form-input" id="limit" value="${limit}">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Charge Class</label>
                            <select class="form-select" id="chargeClassSelect">
                                <option ${chargeClass === 'Admin' ? 'selected' : ''}>Admin</option>
                                <option ${chargeClass === 'Accounting' ? 'selected' : ''}>Accounting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="categorySelect">
                                <option ${category === 'Required' ? 'selected' : ''}>Required</option>
                                <option ${category === 'Add-on' ? 'selected' : ''}>Add-on</option>
                                <option ${category === 'Situational' ? 'selected' : ''}>Situational</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Timing</label>
                            <select class="form-select" id="timingSelect">
                                <option ${timing === 'Application' ? 'selected' : ''}>Application</option>
                                <option ${timing === 'Move-in' ? 'selected' : ''}>Move-in</option>
                                <option ${timing === 'Move-out' ? 'selected' : ''}>Move-out</option>
                                <option ${timing === 'Monthly' ? 'selected' : ''}>Monthly</option>
                                <option ${timing === 'Move-in and Monthly' ? 'selected' : ''}>Move-in and Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Frequency</label>
                            <select class="form-select" id="frequencySelect">
                                <option ${frequency === 'One-Time' ? 'selected' : ''}>One-Time</option>
                                <option ${frequency === 'Recurring' ? 'selected' : ''}>Recurring</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <select class="form-select" id="methodSelect">
                                <option ${method === 'Per Unit' ? 'selected' : ''}>Per Unit</option>
                                <option ${method === 'Per Pet' ? 'selected' : ''}>Per Pet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment To</label>
                            <select class="form-select" id="paymentToSelect">
                                <option ${paymentTo === 'Property' ? 'selected' : ''}>Property</option>
                                <option ${paymentTo === 'Third Party' ? 'selected' : ''}>Third Party</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Lease Doc Setting</label>
                            <select class="form-select" id="leaseDocSettingSelect">
                                <option ${leaseDocSetting === 'None' ? 'selected' : ''}>None</option>
                                <option ${leaseDocSetting === 'Both' ? 'selected' : ''}>Both</option>
                                <option ${leaseDocSetting === 'Lease' ? 'selected' : ''}>Lease</option>
                                <option ${leaseDocSetting === 'Renewal' ? 'selected' : ''}>Renewal</option>
                            </select>
                        </div>
                        <div class="form-group"></div>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: flex-end; align-items: center; width: 100%; gap: 12px;">
                    <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                    <button class="btn btn-primary">
                        Save Changes
                    </button>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');
            
            if (editOverlay && editPageslide) {
                // Set content
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;
                
                // Set size
                editPageslide.setAttribute('data-pageslide-size', 'md');
                
                // Show pageslide
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                // Replace default header with custom header
                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }
                }, 50);
            }
        }

        // Function to open Add Fee pageslide
        function openAddFeePageslide() {
            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0;">Add New Charge and Fee</h2>
                    <i class="fas fa-times" onclick="closeEditPageslide()" style="cursor: pointer;"></i>
                </div>
            `;

            const formContent = `
                <div style="">
                    <!-- Fee Name and Charge Code -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-fee-name" class="form-label">Fee Name</label>
                            <input type="text" id="new-fee-name" class="form-input" placeholder="Enter fee name">
                        </div>
                        <div class="form-group">
                            <label for="new-charge-code" class="form-label">Charge Code</label>
                            <input type="text" id="new-charge-code" class="form-input" placeholder="Enter charge code">
                        </div>
                    </div>

                    <!-- Amount Type and Amount -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-amount-type" class="form-label">Amount Type</label>
                            <select id="new-amount-type" class="form-select">
                                <option selected>Fixed</option>
                                <option>Variable</option>
                                <option>Percentage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-amount" class="form-label">Amount</label>
                            <input type="text" id="new-amount" class="form-input" value="0.00">
                        </div>
                    </div>

                    <!-- Fee flags (match Edit Fee checkbox layout) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; margin-bottom: 24px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="new-required" checked style="width: auto; height: auto;">
                                <label for="new-required" style="margin: 0; font-weight: 400; font-size: 14px !important;">Required</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="new-refundable" style="width: auto; height: auto;">
                                <label for="new-refundable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Refundable</label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="new-taxable" style="width: auto; height: auto;">
                                <label for="new-taxable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Taxable</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="new-hide-cost" style="width: auto; height: auto;">
                                <label for="new-hide-cost" style="margin: 0; font-weight: 400; font-size: 14px !important;">Hide from Cost Estimate</label>
                            </div>
                        </div>
                    </div>

                    <!-- Fee Description -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="new-fee-description" class="form-label">Fee Description</label>
                        <textarea id="new-fee-description" class="form-textarea" rows="3" placeholder="Describe the fee for applicants"></textarea>
                    </div>

                    <!-- Months to Start / Duration / Limit -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-months-to-start" class="form-label">Months to Start</label>
                            <input type="number" id="new-months-to-start" class="form-input" value="0">
                        </div>
                        <div class="form-group">
                            <label for="new-duration" class="form-label">Duration</label>
                            <input type="number" id="new-duration" class="form-input" value="0">
                        </div>
                        <div class="form-group">
                            <label for="new-limit" class="form-label">Limit</label>
                            <input type="number" id="new-limit" class="form-input" value="0">
                        </div>
                    </div>

                    <!-- Charge Class / Category -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-charge-class" class="form-label">Charge Class</label>
                            <select id="new-charge-class" class="form-select">
                                <option selected>Admin</option>
                                <option>Accounting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-category" class="form-label">Category</label>
                            <select id="new-category" class="form-select">
                                <option selected>Required</option>
                                <option>Add-on</option>
                                <option>Situational</option>
                            </select>
                        </div>
                    </div>

                    <!-- Timing / Frequency -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-timing" class="form-label">Timing</label>
                            <select id="new-timing" class="form-select">
                                <option selected>Application</option>
                                <option>Move-in</option>
                                <option>Move-out</option>
                                <option>Monthly</option>
                                <option>Move-in and Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-frequency" class="form-label">Frequency</label>
                            <select id="new-frequency" class="form-select">
                                <option selected>One-Time</option>
                                <option>Recurring</option>
                            </select>
                        </div>
                    </div>

                    <!-- Method / Payment To -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="new-method" class="form-label">Method</label>
                            <select id="new-method" class="form-select">
                                <option selected>Per Unit</option>
                                <option>Per Pet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-payment-to" class="form-label">Payment To</label>
                            <select id="new-payment-to" class="form-select">
                                <option selected>Property</option>
                                <option>Third Party</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lease Doc Setting -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="new-lease-doc-setting" class="form-label">Lease Doc Setting</label>
                        <select id="new-lease-doc-setting" class="form-select">
                            <option selected>None</option>
                            <option>Both</option>
                            <option>Lease</option>
                            <option>Renewal</option>
                        </select>
                    </div>

                    <!-- Apply to Unit Types -->
                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <label class="form-label" style="margin: 0;">Apply to Unit Types</label>
                            <div style="display: flex; gap: 16px;">
                                <a href="javascript:void(0)" onclick="selectAllUnitTypes()" style="font-size: 14px;">Select All</a>
                                <span style="color: #d1d5db;">|</span>
                                <a href="javascript:void(0)" onclick="deselectAllUnitTypes()" style="font-size: 14px;">Deselect All</a>
                            </div>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: white;">
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-1br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-1br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">1BR-A</label>
                                    <span class="text-sm text-muted">16 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-1br-b" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-1br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">1BR-B</label>
                                    <span class="text-sm text-muted">12 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-2br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-2br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">2BR-A</label>
                                    <span class="text-sm text-muted">24 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-2br-b" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-2br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">2BR-B</label>
                                    <span class="text-sm text-muted">18 units</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="unit-3br-a" class="unit-type-checkbox" checked style="width: auto; height: auto;">
                                    <label for="unit-3br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; flex: 1;">3BR-A</label>
                                    <span class="text-sm text-muted">8 units</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span class="text-sm text-muted" id="unit-types-count" data-prefix="Applying to">Applying to 5 unit types</span>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                        <button class="btn btn-primary">
                            Add Fee
                        </button>
                    </div>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');
            
            if (editOverlay && editPageslide) {
                // Set content
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;
                
                // Set size
                editPageslide.setAttribute('data-pageslide-size', 'md');
                
                // Show pageslide
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                // Replace default header with custom header
                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }
                    
                    // Add event listeners for unit type checkboxes
                    updateUnitTypesCount();
                    document.querySelectorAll('.unit-type-checkbox').forEach(checkbox => {
                        checkbox.addEventListener('change', updateUnitTypesCount);
                    });
                }, 50);
            }
        }

        // Property > Display Only Fees: Add Fee pageslide (no unit type selection)
        function openAddPropertyDisplayOnlyFeePageslide() {
            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0;">Add New Fee</h2>
                    <i class="fas fa-times" onclick="closeEditPageslide()" style="cursor: pointer;"></i>
                </div>
            `;

            const formContent = `
                <div style="">
                    <!-- Fee Name and Charge Code -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-fee-name" class="form-label">Fee Name</label>
                            <input type="text" id="property-new-fee-name" class="form-input" placeholder="Enter fee name">
                        </div>
                        <div class="form-group">
                            <label for="property-new-charge-code" class="form-label">Charge Code</label>
                            <input type="text" id="property-new-charge-code" class="form-input" placeholder="Enter charge code">
                        </div>
                    </div>

                    <!-- Amount Type and Amount -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-amount-type" class="form-label">Amount Type</label>
                            <select id="property-new-amount-type" class="form-select">
                                <option selected>Fixed</option>
                                <option>Variable</option>
                                <option>Percentage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-new-amount" class="form-label">Amount</label>
                            <input type="text" id="property-new-amount" class="form-input" value="0.00">
                        </div>
                    </div>

                    <!-- Fee flags (match Edit Fee checkbox layout) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; margin-bottom: 24px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-new-required" checked style="width: auto; height: auto;">
                                <label for="property-new-required" style="margin: 0; font-weight: 400; font-size: 14px !important;">Required</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-new-refundable" style="width: auto; height: auto;">
                                <label for="property-new-refundable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Refundable</label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-new-taxable" style="width: auto; height: auto;">
                                <label for="property-new-taxable" style="margin: 0; font-weight: 400; font-size: 14px !important;">Taxable</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-new-hide-cost" style="width: auto; height: auto;">
                                <label for="property-new-hide-cost" style="margin: 0; font-weight: 400; font-size: 14px !important;">Hide from Cost Estimate</label>
                            </div>
                        </div>
                    </div>

                    <!-- Fee Description -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="property-new-fee-description" class="form-label">Fee Description</label>
                        <textarea id="property-new-fee-description" class="form-textarea" rows="3" placeholder="Describe the fee for applicants"></textarea>
                    </div>

                    <!-- Months to Start / Duration / Limit -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-months-to-start" class="form-label">Months to Start</label>
                            <input type="number" id="property-new-months-to-start" class="form-input" value="0">
                        </div>
                        <div class="form-group">
                            <label for="property-new-duration" class="form-label">Duration</label>
                            <input type="number" id="property-new-duration" class="form-input" value="0">
                        </div>
                        <div class="form-group">
                            <label for="property-new-limit" class="form-label">Limit</label>
                            <input type="number" id="property-new-limit" class="form-input" value="0">
                        </div>
                    </div>

                    <!-- Charge Class / Category -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-charge-class" class="form-label">Charge Class</label>
                            <select id="property-new-charge-class" class="form-select">
                                <option selected>Admin</option>
                                <option>Accounting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-new-category" class="form-label">Category</label>
                            <select id="property-new-category" class="form-select">
                                <option selected>Required</option>
                                <option>Add-on</option>
                                <option>Situational</option>
                            </select>
                        </div>
                    </div>

                    <!-- Timing / Frequency -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-timing" class="form-label">Timing</label>
                            <select id="property-new-timing" class="form-select">
                                <option selected>Application</option>
                                <option>Move-in</option>
                                <option>Move-out</option>
                                <option>Monthly</option>
                                <option>Move-in and Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-new-frequency" class="form-label">Frequency</label>
                            <select id="property-new-frequency" class="form-select">
                                <option selected>One-Time</option>
                                <option>Recurring</option>
                            </select>
                        </div>
                    </div>

                    <!-- Method / Payment To -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-new-method" class="form-label">Method</label>
                            <select id="property-new-method" class="form-select">
                                <option selected>Per Unit</option>
                                <option>Per Pet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-new-payment-to" class="form-label">Payment To</label>
                            <select id="property-new-payment-to" class="form-select">
                                <option selected>Property</option>
                                <option>Third Party</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lease Doc Setting -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="property-new-lease-doc-setting" class="form-label">Lease Doc Setting</label>
                        <select id="property-new-lease-doc-setting" class="form-select">
                            <option selected>None</option>
                            <option>Both</option>
                            <option>Lease</option>
                            <option>Renewal</option>
                        </select>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: flex-end; align-items: center; width: 100%; gap: 12px;">
                    <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                    <button class="btn btn-primary">Add Fee</button>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');

            if (editOverlay && editPageslide) {
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;

                editPageslide.setAttribute('data-pageslide-size', 'md');
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }
                }, 50);
            }
        }

        // Helper functions for unit type selection
        function selectAllUnitTypes() {
            document.querySelectorAll('.unit-type-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateUnitTypesCount();
        }

        function deselectAllUnitTypes() {
            document.querySelectorAll('.unit-type-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateUnitTypesCount();
        }

        function updateUnitTypesCount() {
            const checkedCount = document.querySelectorAll('.unit-type-checkbox:checked').length;
            const countElement = document.getElementById('unit-types-count');
            if (countElement) {
                const prefix = countElement.getAttribute('data-prefix') || 'Adding to';
                countElement.textContent = `${prefix} ${checkedCount} unit type${checkedCount !== 1 ? 's' : ''}`;
            }
        }

        // Function to open Load Template pageslide
        function openLoadTemplatePageslide() {
            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0 0 6px 0;">Load Template</h2>
                    <p class="text-sm text-muted" style="margin: 0;">Select a template to apply to unit types at this property</p>
                    <i class="fas fa-times" onclick="closeEditPageslide()"></i>
                </div>
            `;

            const formContent = `
                <div style="">
                    <!-- Select Template -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="template-select" class="form-label">Select Template</label>
                        <select id="template-select" class="form-select">
                            <option selected>Standard Move-In Fees 2025</option>
                            <option>Pet-Friendly Units</option>
                            <option>Luxury Units</option>
                        </select>
                    </div>

                    <!-- Template Info -->
                    <div class="text-sm text-muted" style="margin-bottom: 16px;">
                        12 fees  Auto-sync to Preview  Published
                    </div>

                    <!-- Template Sync Mode Alert -->
                    <div class="alert alert-info" style="margin-bottom: 24px; display: flex; align-items: flex-start; gap: 12px;">
                        <i class="fas fa-info-circle" style="margin-top: 2px;"></i>
                        <div>
                            <div style="display: block; margin-bottom: 4px;">Template Sync Mode</div>
                            <span>This template has auto-sync enabled. Unit types will automatically receive future template updates.</span>
                        </div>
                    </div>

                    <!-- Select Unit Types -->
                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <label class="form-label" style="margin: 0;">Select Unit Types</label>
                            <div style="display: flex; gap: 16px;">
                                <a href="javascript:void(0)" onclick="selectAllTemplateUnitTypes()" style="font-size: 14px;">Select All</a>
                                <span style="color: #d1d5db;">|</span>
                                <a href="javascript:void(0)" onclick="deselectAllTemplateUnitTypes()" style="font-size: 14px;">Deselect All</a>
                            </div>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px;">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="template-unit-1br-a" class="template-unit-checkbox" checked style="width: auto; height: auto; margin-top: 4px;">
                                    <div style="flex: 1;">
                                        <label for="template-unit-1br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; display: block;">1BR-A</label>
                                        <span class="text-sm text-muted">16 units  Currently using: Standard Move-In</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="template-unit-1br-b" class="template-unit-checkbox" checked style="width: auto; height: auto; margin-top: 4px;">
                                    <div style="flex: 1;">
                                        <label for="template-unit-1br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; display: block;">1BR-B</label>
                                        <span class="text-sm text-muted">12 units  Currently using: Standard Move-In</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="template-unit-2br-a" class="template-unit-checkbox" checked style="width: auto; height: auto; margin-top: 4px;">
                                    <div style="flex: 1;">
                                        <label for="template-unit-2br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; display: block;">2BR-A</label>
                                        <span class="text-sm text-muted">24 units  Currently using: Standard Move-In</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="template-unit-2br-b" class="template-unit-checkbox" checked style="width: auto; height: auto; margin-top: 4px;">
                                    <div style="flex: 1;">
                                        <label for="template-unit-2br-b" style="margin: 0; font-weight: 500; font-size: 14px !important; display: block;">2BR-B</label>
                                        <span class="text-sm text-muted">18 units  Currently using: No template</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <input type="checkbox" id="template-unit-3br-a" class="template-unit-checkbox" checked style="width: auto; height: auto; margin-top: 4px;">
                                    <div style="flex: 1;">
                                        <label for="template-unit-3br-a" style="margin: 0; font-weight: 500; font-size: 14px !important; display: block;">3BR-A</label>
                                        <span class="text-sm text-muted">8 units  Currently using: Luxury Units</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span class="text-sm text-muted" id="template-unit-types-count">5 unit types selected</span>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                        <button class="btn btn-primary">
                            Load Template
                        </button>
                    </div>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');
            
            if (editOverlay && editPageslide) {
                // Set content
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;
                
                // Set size
                editPageslide.setAttribute('data-pageslide-size', 'md');
                
                // Show pageslide
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                // Replace default header with custom header
                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }
                    
                    // Add event listeners for unit type checkboxes
                    updateTemplateUnitTypesCount();
                    document.querySelectorAll('.template-unit-checkbox').forEach(checkbox => {
                        checkbox.addEventListener('change', updateTemplateUnitTypesCount);
                    });
                }, 50);
            }
        }

        // Helper functions for template unit type selection
        function selectAllTemplateUnitTypes() {
            document.querySelectorAll('.template-unit-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            updateTemplateUnitTypesCount();
        }

        function deselectAllTemplateUnitTypes() {
            document.querySelectorAll('.template-unit-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateTemplateUnitTypesCount();
        }

        function updateTemplateUnitTypesCount() {
            const checkedCount = document.querySelectorAll('.template-unit-checkbox:checked').length;
            const countElement = document.getElementById('template-unit-types-count');
            if (countElement) {
                countElement.textContent = `${checkedCount} unit type${checkedCount !== 1 ? 's' : ''} selected`;
            }
        }

        // Function to toggle property fee sections (accordion)
        function togglePropertyFeeSection(sectionId) {
            const content = document.getElementById('content-' + sectionId);
            const icon = document.getElementById('icon-' + sectionId);
            const header = icon ? icon.closest('.accordion-header') : null;
            
            if (content && icon) {
                // Toggle the accordion body
                content.classList.toggle('show');
                
                // Rotate the chevron
                if (content.classList.contains('show')) {
                    icon.style.transform = 'rotate(90deg)';
                    if (header) header.classList.add('expanded');
                } else {
                    icon.style.transform = 'rotate(0deg)';
                    if (header) header.classList.remove('expanded');
                }
            }
        }

        // Function to open Edit Property Fee pageslide
        function openEditPropertyFee(feeName, amount) {
            const headerContent = `
                <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 18px; font-weight: 600; margin: 0;">Edit Fee</h2>
                    <i class="fas fa-times" onclick="closeEditPageslide()" style="cursor: pointer;"></i>
                </div>
            `;

            const formContent = `
                <div style="">
                    <div class="alert alert-info" style="margin-bottom: 16px; display: flex; align-items: flex-start; gap: 12px;">
                        <i class="fas fa-circle-info" style="margin-top: 2px;"></i>
                        <div>The grayed out settings pull directly from Property Control Settings and cannot be modified here.</div>
                    </div>

                    <!-- Fee Name and Charge Code -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-fee-name" class="form-label">Fee Name</label>
                            <input type="text" id="property-fee-name" class="form-input" value="${feeName}" disabled>
                        </div>
                        <div class="form-group">
                            <label for="property-charge-code" class="form-label">Charge Code</label>
                            <input type="text" id="property-charge-code" class="form-input" value="" disabled>
                        </div>
                    </div>

                    <!-- Amount Type and Amount -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
                        <div class="form-group">
                            <label for="property-amount-type" class="form-label">Amount Type</label>
                            <select id="property-amount-type" class="form-select" disabled>
                                <option selected>Fixed</option>
                                <option>Variable</option>
                                <option>Percentage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-amount" class="form-label">Amount</label>
                            <input type="text" id="property-amount" class="form-input" value="${amount}">
                        </div>
                    </div>

                    <!-- Required/Refundable/Taxable/Hide from Cost Estimate -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; margin-bottom: 24px;">
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-required" checked disabled style="width: auto; height: auto;">
                                <label for="property-required" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Required</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-refundable" disabled style="width: auto; height: auto;">
                                <label for="property-refundable" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Refundable</label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-taxable" disabled style="width: auto; height: auto;">
                                <label for="property-taxable" style="margin: 0; font-weight: 400; font-size: 14px !important;" class="text-gray">Taxable</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="property-hide-cost" style="width: auto; height: auto;">
                                <label for="property-hide-cost" style="margin: 0; font-weight: 400; font-size: 14px !important;">Hide from Cost Estimate</label>
                            </div>
                        </div>
                    </div>

                    <!-- Fee Description -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="property-fee-description" class="form-label">Fee Description</label>
                        <textarea id="property-fee-description" class="form-textarea" rows="3" placeholder="Describe the fee for applicants"></textarea>
                    </div>

                    <!-- Months to Start / Duration / Limit -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-months-to-start" class="form-label">Months to Start</label>
                            <input type="number" id="property-months-to-start" class="form-input" value="0" disabled>
                        </div>
                        <div class="form-group">
                            <label for="property-duration" class="form-label">Duration</label>
                            <input type="number" id="property-duration" class="form-input" value="0" disabled>
                        </div>
                        <div class="form-group">
                            <label for="property-limit" class="form-label">Limit</label>
                            <input type="number" id="property-limit" class="form-input" value="0">
                        </div>
                    </div>

                    <!-- Charge Class / Category -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-charge-class" class="form-label">Charge Class</label>
                            <select id="property-charge-class" class="form-select">
                                <option selected>Admin</option>
                                <option>Accounting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-category" class="form-label">Category</label>
                            <select id="property-category" class="form-select">
                                <option selected>Required</option>
                                <option>Add-on</option>
                                <option>Situational</option>
                            </select>
                        </div>
                    </div>

                    <!-- Timing / Frequency -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-timing" class="form-label">Timing</label>
                            <select id="property-timing" class="form-select">
                                <option selected>Move-in</option>
                                <option>Application</option>
                                <option>Move-out</option>
                                <option>Monthly</option>
                                <option>Move-in and Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-frequency" class="form-label">Frequency</label>
                            <select id="property-frequency" class="form-select">
                                <option selected>One-Time</option>
                                <option>Recurring</option>
                            </select>
                        </div>
                    </div>

                    <!-- Method / Payment To -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="form-group">
                            <label for="property-method" class="form-label">Method</label>
                            <select id="property-method" class="form-select">
                                <option selected>Per Unit</option>
                                <option>Per Pet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="property-payment-to" class="form-label">Payment To</label>
                            <select id="property-payment-to" class="form-select">
                                <option selected>Property</option>
                                <option>Third Party</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lease Doc Setting -->
                    <div class="form-group" style="margin-bottom: 16px;">
                        <label for="property-lease-doc-setting" class="form-label">Lease Doc Setting</label>
                        <select id="property-lease-doc-setting" class="form-select">
                            <option selected>None</option>
                            <option>Both</option>
                            <option>Lease</option>
                            <option>Renewal</option>
                        </select>
                    </div>
                </div>
            `;

            const footerContent = `
                <div style="display: flex; justify-content: flex-end; align-items: center; width: 100%; gap: 12px;">
                    <button class="btn btn-light" onclick="closeEditPageslide()">Cancel</button>
                    <button class="btn btn-primary">Save Changes</button>
                </div>
            `;

            // Open edit pageslide in second container
            const editOverlay = document.querySelector('#pageslide-edit-container .pageslide-overlay');
            const editPageslide = document.querySelector('#pageslide-edit-container .pageslide');
            const editBody = document.querySelector('#pageslide-edit-container .pageslide-body');
            const editFooter = document.querySelector('#pageslide-edit-container .pageslide-footer');
            
            if (editOverlay && editPageslide) {
                // Set content
                if (editBody) editBody.innerHTML = formContent;
                if (editFooter) editFooter.innerHTML = footerContent;
                
                // Set size
                editPageslide.setAttribute('data-pageslide-size', 'md');
                
                // Show pageslide
                editOverlay.classList.add('active');
                setTimeout(() => {
                    editPageslide.classList.add('active');
                }, 10);

                // Replace default header with custom header
                setTimeout(() => {
                    const pageslideHeader = document.querySelector('#pageslide-edit-container .pageslide-header');
                    if (pageslideHeader) {
                        pageslideHeader.innerHTML = headerContent;
                        pageslideHeader.style.padding = '0';
                        pageslideHeader.style.borderBottom = 'none';
                    }
                }, 50);
            }
        }
    </script>
</body>
</html>
